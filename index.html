
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GASTOS HOGAR G.G. + Sincronizado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f7f9; }
        .large-form-container { background-color: #ffffff; border: 2px solid #3b82f6; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-button { transition: all 0.3s ease; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 8px 10px; font-size: 0.75rem; }
        .tab-button.active { border-bottom: 3px solid #1d4ed8; background-color: #e0f2fe; font-weight: 600; color: #1d4ed8; }
        .tab-content { display: none; }
       
        /* Estilos para autocompletado */
        .autocomplete-container { position: relative; }
        .autocomplete-input { position: relative; z-index: 2; background: transparent; }
        .autocomplete-suggestion { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: auto; color: #9ca3af; padding-top: 0.5rem; padding-left: 0.75rem; }
    </style>
    <script type="module">
        // *** REVISA Y CONFIRMA ESTA URL ***
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwUCi65SBCfKK3uMIivqDz3kJ8rxIITfNFo7QYV3Jnbvv3sKgm76vmNpGp6kq-gu6_TCw/exec"
       
        // --- CONSTANTES ---
        const PAYERS = ['Juan', 'Tania'];
        const CATEGORIES = {
            DAILY: ['PEAJE', 'COMIDA', 'GASOLINA', 'SUPERMERCADO', 'FARMACIA', 'TRANSPORTE', 'PANADERIA'],
            JC_ONLY: ['EL TUNEL (ITAU)', 'CALDO (ITAU)', 'MEDICAMENTOS (BROU)', 'LA GRANOLA (ITAU)', 'CLUB AEBU JUAN (OCA)', 'MOVILES']
        };

        // --- ESTADO (STATE) ---
        let state = {
            daily: [],
            monthly: [],
            jcOnly: []
        };

        // --- ALMACENAMIENTO (Fetch con Overlay de Carga) ---
        async function fetchData(url, options = {}) {
            try {
                // Mostrar overlay de carga antes de la petición
                document.getElementById('loading-overlay').classList.remove('hidden');
               
                const response = await fetch(url, options);
               
                // Ocultar overlay de carga
                document.getElementById('loading-overlay').classList.add('hidden');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
               
                if (data.success === false) {
                     throw new Error(`Error de la API: ${data.message}`);
                }
                return data;
            } catch (e) {
                console.error("Error en la operación de red/API:", e);
                // Ocultar overlay de carga en caso de error
                document.getElementById('loading-overlay').classList.add('hidden');
                alertUser("Error de Sincronización", `No se pudo conectar con Google Sheets. ${e.message}`);
                return null;
            }
        }

        async function loadData() {
            const data = await fetchData(GAS_URL + '?action=GET');

            if (data) {
                // El Apps Script ya nos devuelve la estructura {daily, monthly, jcOnly}
                state.daily = data.daily || [];
                state.monthly = data.monthly || [];
                state.jcOnly = data.jcOnly || [];
                renderAll();
            } else {
                // Dejar el estado vacío si falla la carga.
                state = { daily: [], monthly: [], jcOnly: [] };
            }
        }
       
        // --- UTILIDADES ---
       
        // 1. Modal para ERRORES CRÍTICOS
        window.alertUser = (title, message) => {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('custom-modal').classList.remove('hidden');
        };

        window.closeModal = () => {
            document.getElementById('custom-modal').classList.add('hidden');
        };

        // 2. Función para NOTIFICACIONES FLOTANTES
        window.showToast = (message, type = 'success') => {
            const container = document.getElementById('toast-container');
           
            let colorClass = 'bg-green-600';
            if (type === 'error') colorClass = 'bg-red-600';
            if (type === 'warning') colorClass = 'bg-yellow-600';
           
            const toast = document.createElement('div');
            toast.className = `${colorClass} text-white px-4 py-3 rounded-lg shadow-xl font-semibold opacity-0 transition-opacity duration-300 ease-out mb-2 pointer-events-auto`;
            toast.textContent = message;
           
            container.appendChild(toast);
           
            // Mostrar el toast
            setTimeout(() => {
                toast.classList.remove('opacity-0');
                toast.classList.add('opacity-100');
            }, 10);

            // Ocultar y eliminar después de 3 segundos
            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
                // Esperar a que termine la transición para eliminarlo
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        };
       
        function findExpense(id, type) {
            const list = state[type];
            return list.find(item => item.id == id);
        }

        function getListByType(type) {
            return state[type];
        }

        // --- LÓGICA AUTOCOMPLETADO ---
        function updateSuggestion(inputId, suggestionId, categoryList) {
            const input = document.getElementById(inputId);
            const suggestionSpan = document.getElementById(suggestionId);
            const query = input.value.toUpperCase();
           
            if (query.length === 0) { suggestionSpan.textContent = ''; return; }

            const bestMatch = categoryList.find(cat => cat.startsWith(query));
            if (bestMatch) {
                suggestionSpan.textContent = input.value + bestMatch.substring(query.length);
            } else {
                suggestionSpan.textContent = '';
            }
        }

        window.acceptSuggestion = (inputId, suggestionId) => {
            const input = document.getElementById(inputId);
            const suggestionSpan = document.getElementById(suggestionId);
            if (suggestionSpan.textContent) {
                input.value = suggestionSpan.textContent;
                suggestionSpan.textContent = '';
            }
        };

        window.setupAutocompleteListeners = () => {
            const setupListener = (inputId, suggestionId, list) => {
                const el = document.getElementById(inputId);
                if (!el) return;
                el.addEventListener('input', () => updateSuggestion(inputId, suggestionId, list));
                el.addEventListener('click', () => acceptSuggestion(inputId, suggestionId));
                el.addEventListener('keydown', (e) => {
                    if (e.key === 'Tab' || e.key === 'Enter') {
                        acceptSuggestion(inputId, suggestionId);
                        if (e.key === 'Enter') e.preventDefault();
                    }
                });
            };
            setupListener('concepto-diario', 'suggestion-diario', CATEGORIES.DAILY);
            setupListener('concepto-jc', 'suggestion-jc', CATEGORIES.JC_ONLY);
        };

        // --- LÓGICA PRINCIPAL: REGISTRAR (Fetch POST) ---
       
        async function registerExpense(formId, type) {
            const form = document.getElementById(formId);
            const concepto = form.concepto.value.trim();
            const montoInput = form.monto.value;
            const monto = parseFloat(montoInput);
           
            // 1. Validar que el campo no esté vacío
            if (montoInput === "" || !concepto) {
                alertUser("Datos Incompletos", "Por favor, completa el Monto y el Concepto.");
                return;
            }

            // 2. Validar que el monto sea un número y no sea negativo
            if (isNaN(monto) || monto < 0) {
                alertUser("Monto Inválido", "El monto debe ser un número válido y no puede ser negativo.");
                return;
            }

            // 3. Validar que se haya seleccionado un pagador (solo para DAILY y MONTHLY)
            if (type === 'daily' && !form.pagador.value) {
                alertUser("Pagador Requerido", "Por favor, selecciona quién hizo el pago.");
                return;
            }
            if (type === 'monthly' && !form.pagador_mensual.value) {
                alertUser("Pagador Requerido", "Por favor, selecciona quién hizo el pago.");
                return;
            }

            let newExpense = {
                id: Date.now(),
                concepto: concepto.toUpperCase(),
                monto: monto,
                timestamp: new Date().toISOString(),
            };

            if (type === 'daily') {
                newExpense.payer = form.pagador.value;
            } else if (type === 'monthly') {
                newExpense.tipo = form.tipo_gasto.value;
                newExpense.payer = form.pagador_mensual.value;
            } else if (type === 'jcOnly') {
                newExpense.payer = 'Tania'; // Lo paga Tania
                newExpense.debtor = 'Juan'; // Lo debe Juan (Mi género es masculino)
            }
           
            const postData = {
                action: 'ADD',
                type: type,
                data: newExpense
            };

            const result = await fetchData(GAS_URL, {
                method: 'POST',
                mode: 'cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'text/plain' }, // Necesario para Apps Script
                body: JSON.stringify(postData)
            });
           
            if (result && result.success) {
                form.reset();
                document.querySelectorAll('.autocomplete-suggestion').forEach(el => el.textContent = '');
               
                // Recargar los datos desde la hoja para asegurar la sincronización
                await loadData();
               
                showToast("Gasto agregado con éxito!");
            }
        }

        window.registerDailyExpense = () => registerExpense('daily-form', 'daily');
        window.registerMonthlyExpense = () => registerExpense('monthly-form', 'monthly');
        window.registerJcExpense = () => registerExpense('jc-form', 'jcOnly');

        // --- LÓGICA PRINCIPAL: ELIMINAR (Fetch POST) ---
        window.deleteExpense = async (id, type) => {
            if(!confirm("¿Estás seguro de que deseas eliminar este gasto?")) return;

            const postData = {
                action: 'DELETE',
                type: type,
                id: id
            };

            const result = await fetchData(GAS_URL, {
                method: 'POST',
                mode: 'cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(postData)
            });
           
            if (result && result.success) {
                // Recargar los datos desde la hoja
                await loadData();
               
                showToast("Gasto eliminado correctamente.");
            }
        };

        // --- LÓGICA PRINCIPAL: EDITAR (Abrir Modal) ---
        window.editExpense = (id, type) => {
            const expense = findExpense(id, type);
            if (!expense) return alertUser("Error", "Gasto no encontrado para edición. Intenta recargar la página.");
           
            const modal = document.getElementById('edit-modal');
            const form = document.getElementById('edit-form');
           
            const payerField = document.getElementById('edit-payer-field');
            if (type === 'daily' || type === 'monthly') {
                payerField.classList.remove('hidden');
                form['edit-pagador'].value = expense.payer;
            } else { // jcOnly
                payerField.classList.add('hidden');
            }

            form['edit-id'].value = id;
            form['edit-type'].value = type;
            form['edit-concepto'].value = expense.concepto;
            form['edit-monto'].value = expense.monto;
           
            modal.classList.remove('hidden');
        };

        // --- LÓGICA PRINCIPAL: EDITAR (Guardar Cambios) (Fetch POST) ---
        window.saveEditedExpense = async () => {
            const form = document.getElementById('edit-form');
            const id = form['edit-id'].value;
            const type = form['edit-type'].value;
            const concepto = form['edit-concepto'].value.trim();
            const monto = parseFloat(form['edit-monto'].value);
            const payer = form['edit-pagador'].value;

            if (!concepto || isNaN(monto) || monto < 0) {
                return alertUser("Datos Inválidos", "Concepto requerido y monto debe ser igual o superior a cero.");
            }

            let updatedExpense = {
                id: id,
                concepto: concepto.toUpperCase(),
                monto: monto,
            };

            if (type === 'daily' || type === 'monthly') {
                updatedExpense.payer = payer;
            }
           
            const postData = {
                action: 'EDIT',
                type: type,
                data: updatedExpense
            };

            const result = await fetchData(GAS_URL, {
                method: 'POST',
                mode: 'cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(postData)
            });

            if (result && result.success) {
                document.getElementById('edit-modal').classList.add('hidden');
                await loadData(); // Recargar datos
               
                showToast("Gasto editado con éxito.");
            }
        };

        window.closeEditModal = () => {
            document.getElementById('edit-modal').classList.add('hidden');
        };


        // --- LÓGICA PRINCIPAL: EXPORTAR ---
        window.exportData = () => {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Tipo,Fecha,Concepto,Pagador,Monto\n";

            const processList = (list, typeName) => {
                list.forEach(item => {
                    const date = new Date(item.timestamp).toLocaleDateString();
                    const safeConcept = `"${item.concepto.replace(/"/g, '""')}"`;
                    csvContent += `${typeName},${date},${safeConcept},${item.payer || item.debtor},${item.monto}\n`;
                });
            };

            processList(state.daily, "DIARIO");
            processList(state.monthly, "MENSUAL");
            processList(state.jcOnly, "JC_ONLY");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "gastos_hogar_gg_sincronizados.csv");
            document.body.appendChild(link);
            link.click();
        };

        // --- LÓGICA PRINCIPAL: Cierre de Mes (Fetch POST) ---
        window.resetMonthlyExpenses = async () => {
            const totalDiffEl = document.getElementById('combined-balance-display');
            const messageContent = totalDiffEl.querySelector('span') ? totalDiffEl.querySelector('span').textContent.trim() : '¡Cuentas Saldadas!';
           
            let confirmationMessage = '';
            if (totalDiffEl.innerHTML.includes('Saldadas')) {
                confirmationMessage = "ADVERTENCIA: Las cuentas parecen estar saldadas. ¿Deseas borrar de todas formas los registros históricos y empezar un nuevo mes?";
            } else {
                confirmationMessage = `SALDO PENDIENTE DETECTADO.\n\n${messageContent} a liquidar.\n\n¿Confirma que este saldo ha sido liquidado (pagado) y desea borrar TODOS los gastos (Diarios, Mensuales y JC) para empezar un nuevo mes?`;
            }

            if (!confirm(confirmationMessage)) {
                return;
            }

            // Llamada POST para borrar todo en Sheets
            const postData = {
                action: 'RESET_ALL',
                type: 'daily', // el tipo no importa para esta acción, pero se envía
            };

            const result = await fetchData(GAS_URL, {
                method: 'POST',
                mode: 'cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(postData)
            });

            if (result && result.success) {
                // 3. Recargar el estado vacío y notificar
                await loadData();
                alertUser("¡Ciclo Cerrado!", "Todos los gastos han sido borrados de Google Sheets. La contabilidad mensual empieza ahora en 0.00.");
                switchTab('gastos-diarios');
            }
        };


        // --- CÁLCULO DE BALANCE ---
        function calculateBalance(expenseArray, type) {
            let totalJuanPaid = 0;
            let totalTaniaPaid = 0;
            let totalExpense = 0;

            expenseArray.forEach(exp => {
                totalExpense += exp.monto;
                if (exp.payer === 'Juan') totalJuanPaid += exp.monto;
                else if (exp.payer === 'Tania') totalTaniaPaid += exp.monto;
            });

            if (type === 'daily' || type === 'monthly') {
                const requiredPerPerson = totalExpense / 2;
                return {
                    totalExpense,
                    juanDifference: totalJuanPaid - requiredPerPerson,
                    totalJuanPaid,
                    totalTaniaPaid
                };
            }

            if (type === 'jcOnly') {
                // Juan debe el total de lo que pagó Tania. La diferencia es el total que pagó Tania (negativo para Juan)
                return {
                    totalExpense: totalTaniaPaid + totalJuanPaid,
                    juanNetDebtToTania: -totalTaniaPaid,
                    totalJuanPaid,
                    totalTaniaPaid
                };
            }
            return {};
        }

        // --- RENDERIZADO ---
        function formatBalanceHTML(difference) {
            const absDiff = Math.abs(difference);
            const formatted = absDiff.toFixed(2);
            let color = 'text-gray-600';
            let message = `¡Cuentas Saldadas!`;

            if (absDiff > 0.01) {
                if (difference > 0) {
                    color = 'text-green-600';
                    message = `Tania le debe <span class="text-2xl">$${formatted}</span> a Juan`;
                } else {
                    color = 'text-red-600';
                    message = `Juan le debe <span class="text-2xl">$${formatted}</span> a Tania`;
                }
            }
            return `<div class="p-4 font-bold text-lg text-center ${color} bg-white rounded shadow-sm">${message}</div>`;
        }

        function getBalanceText(difference) {
            const absDiff = Math.abs(difference);
            if (absDiff < 0.01) return "Saldado";
            return difference > 0 ? `Tania debe $${absDiff.toFixed(2)}` : `Juan debe $${absDiff.toFixed(2)}`;
        }

        function renderBalance() {
            const daily = calculateBalance(state.daily, 'daily');
            const monthly = calculateBalance(state.monthly, 'monthly');
            const jc = calculateBalance(state.jcOnly, 'jcOnly');

            const updateEl = (id, html) => { const el = document.getElementById(id); if(el) el.innerHTML = html; };
            updateEl('daily-balance-display', formatBalanceHTML(daily.juanDifference));
            updateEl('monthly-balance-display', formatBalanceHTML(monthly.juanDifference));
            updateEl('jc-balance-display', formatBalanceHTML(jc.juanNetDebtToTania));

            document.getElementById('daily-balance-summary').textContent = getBalanceText(daily.juanDifference);
            document.getElementById('daily-paid-summary').textContent = `J: $${daily.totalJuanPaid.toFixed(0)} | T: $${daily.totalTaniaPaid.toFixed(0)}`;
           
            document.getElementById('monthly-balance-summary').textContent = getBalanceText(monthly.juanDifference);
            document.getElementById('monthly-paid-summary').textContent = `J: $${monthly.totalJuanPaid.toFixed(0)} | T: $${monthly.totalTaniaPaid.toFixed(0)}`;
           
            document.getElementById('jc-balance-summary').textContent = getBalanceText(jc.juanNetDebtToTania);
            document.getElementById('jc-paid-summary').textContent = `J: $${jc.totalJuanPaid.toFixed(0)} | T: $${jc.totalTaniaPaid.toFixed(0)}`;

            const totalDiff = (daily.juanDifference || 0) + (monthly.juanDifference || 0) + (jc.juanNetDebtToTania || 0);
            updateEl('combined-balance-display', formatBalanceHTML(totalDiff));
        }

        function renderLists() {
            const renderList = (elementId, data, type) => {
                const list = document.getElementById(elementId);
                if (!list) return;
               
                // Ordenar por ID/Timestamp de forma descendente para mostrar el más reciente primero
                data.sort((a, b) => b.id - a.id);

                if (data.length === 0) { list.innerHTML = '<li class="p-4 text-center text-gray-400 italic">Sin registros</li>'; return; }

                list.innerHTML = data.map(exp => {
                    const date = new Date(exp.timestamp);
                    const dateStr = `${date.getDate()}/${date.getMonth()+1}`;
                    const payerText = exp.payer === 'Juan' ? `<span class="font-semibold text-blue-600">Juan</span>` : `<span class="font-semibold text-pink-600">Tania</span>`;
                   
                    return `
                        <li class="p-3 border-b border-gray-100 last:border-0 flex justify-between items-center bg-white hover:bg-gray-50 transition">
                            <div class="flex-1">
                                <div class="flex items-baseline gap-2">
                                    <span class="font-bold text-gray-800">${exp.concepto}</span>
                                    <span class="text-xs text-gray-400">${dateStr}</span>
                                </div>
                                <div class="text-xs text-gray-500">Pagó: ${payerText}</div>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="font-bold text-gray-700">$${exp.monto.toFixed(2)}</span>
                               
                                <button onclick="editExpense(${exp.id}, '${type}')" class="text-gray-300 hover:text-blue-500 transition p-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                               
                                <button onclick="deleteExpense(${exp.id}, '${type}')" class="text-gray-300 hover:text-red-500 transition p-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        </li>
                    `;
                }).join('');
            };

            renderList('daily-expense-list', state.daily, 'daily');
            renderList('monthly-expense-list', state.monthly, 'monthly');
            renderList('jc-expense-list', state.jcOnly, 'jcOnly');
        }

        function renderAll() { renderLists(); renderBalance(); }

        // --- INICIALIZACIÓN ---
        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).style.display = 'block';
            document.getElementById(`btn-${tabId}`).classList.add('active');
        };

        window.addEventListener('load', async () => {
            // Eliminar cualquier dato de localStorage, ya no se usa
            localStorage.removeItem('gastos_hogar_gg_data');
           
            // Cargar datos desde Google Sheets
            await loadData();
           
            setupAutocompleteListeners();
            window.switchTab('gastos-diarios');
        });
    </script>
</head>
<body class="bg-gray-100 min-h-screen pb-10">

    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex flex-col items-center justify-center p-4 hidden">
        <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="text-white mt-4 font-semibold text-lg">Sincronizando con Google Sheets...</p>
    </div>
   
    <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-all scale-100">
            <h3 id="modal-title" class="text-xl font-bold text-gray-800 mb-2"></h3>
            <p id="modal-message" class="text-gray-600 mb-6"></p>
            <button onclick="closeModal()" class="w-full py-2.5 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-lg">Entendido</button>
        </div>
    </div>
   
    <div id="edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full transform transition-all scale-100">
            <h3 class="text-xl font-bold text-blue-600 mb-4 border-b pb-2">Editar Gasto</h3>
           
            <form id="edit-form" onsubmit="event.preventDefault(); saveEditedExpense();" class="space-y-4">
               
                <input type="hidden" name="edit-id" id="edit-id">
                <input type="hidden" name="edit-type" id="edit-type">

                <div class="grid grid-cols-2 gap-4">
                    <div id="edit-payer-field">
                        <label class="block text-xs font-bold text-gray-500 uppercase">Pagador</label>
                        <select name="edit-pagador" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="Juan">Juan</option>
                            <option value="Tania">Tania</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase">Monto</label>
                        <input type="number" name="edit-monto" step="0.01" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="0.00" required>
                    </div>
                </div>
               
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Concepto</label>
                    <input type="text" name="edit-concepto" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Ej: Supermercado" required>
                </div>
               
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeEditModal()" class="flex-1 py-2.5 text-gray-600 font-semibold rounded-lg border border-gray-300 hover:bg-gray-100 transition">Cancelar</button>
                    <button type="submit" class="flex-1 py-2.5 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-lg">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
   
    <div class="max-w-3xl mx-auto sm:pt-6">
        <header class="bg-blue-800 text-white p-6 sm:rounded-t-xl shadow-lg flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-extrabold tracking-tight">GASTOS HOGAR G.G.</h1>
                <p class="text-blue-200 text-xs mt-1">Control de Finanzas Compartidas (Sincronizado)</p>
            </div>
            <button onclick="exportData()" class="bg-blue-700 hover:bg-blue-600 text-xs px-3 py-2 rounded border border-blue-500 transition">
                ⬇ CSV
            </button>
        </header>

        <div class="bg-white shadow-md z-10 sticky top-0 sm:static">
            <div class="flex">
                <button id="btn-gastos-diarios" class="tab-button w-1/4" onclick="switchTab('gastos-diarios')">DIARIOS</button>
                <button id="btn-gastos-mensual-anual" class="tab-button w-1/4" onclick="switchTab('gastos-mensual-anual')">MENSUAL</button>
                <button id="btn-gastos-solo-jc" class="tab-button w-1/4" onclick="switchTab('gastos-solo-jc')">SOLO JC</button>
                <button id="btn-balance-final-mensual" class="tab-button w-1/4" onclick="switchTab('balance-final-mensual')">BALANCE</button>
            </div>
        </div>

        <div class="bg-white p-4 sm:p-6 min-h-[500px] sm:rounded-b-xl shadow-lg">

            <div id="gastos-diarios" class="tab-content">
                <div class="large-form-container p-5 rounded-xl mb-6 bg-blue-50 border-blue-200">
                    <form id="daily-form" onsubmit="event.preventDefault(); registerDailyExpense();" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase">Pagador</label>
                                <select name="pagador" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option value="Juan">Juan</option>
                                    <option value="Tania">Tania</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase">Monto ($)</label>
                                <input type="number" name="monto" step="0.01" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="0.00" required>
                            </div>
                        </div>
                       
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase">Concepto (Enter/Tab para completar)</label>
                            <div class="autocomplete-container mt-1">
                                <span id="suggestion-diario" class="autocomplete-suggestion text-sm"></span>
                                <input type="text" name="concepto" id="concepto-diario" class="autocomplete-input block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Ej: Supermercado" required>
                            </div>
                        </div>
                       
                        <button type="submit" class="w-full py-2.5 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-lg mt-4">
                            Registrar Gasto Diario
                        </button>
                    </form>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-1">Balance Diario</h3>
                    <div id="daily-balance-display"></div>
                </div>

                <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-1">Últimos Gastos Diarios</h3>
                <ul id="daily-expense-list" class="divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    </ul>
            </div>
           
            <div id="gastos-mensual-anual" class="tab-content">
                <div class="large-form-container p-5 rounded-xl mb-6 bg-blue-50 border-blue-200">
                    <form id="monthly-form" onsubmit="event.preventDefault(); registerMonthlyExpense();" class="space-y-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase">Pagador</label>
                                <select name="pagador_mensual" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option value="">Seleccionar</option>
                                    <option value="Juan">Juan</option>
                                    <option value="Tania">Tania</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase">Tipo Gasto</label>
                                <select name="tipo_gasto" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option value="MENSUAL">MENSUAL</option>
                                    <option value="ANUAL">ANUAL</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase">Monto ($)</label>
                                <input type="number" name="monto" step="0.01" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="0.00" required>
                            </div>
                        </div>
                       
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase">Concepto</label>
                            <input type="text" name="concepto" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Ej: Ute, Antel, Alquiler" required>
                        </div>
                       
                        <button type="submit" class="w-full py-2.5 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-lg mt-4">
                            Registrar Gasto Mensual
                        </button>
                    </form>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-1">Balance Mensual</h3>
                    <div id="monthly-balance-display"></div>
                </div>

                <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-1">Últimos Gastos Mensuales/Anuales</h3>
                <ul id="monthly-expense-list" class="divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    </ul>
            </div>

            <div id="gastos-solo-jc" class="tab-content">
                <div class="large-form-container p-5 rounded-xl mb-6 bg-blue-50 border-blue-200">
                    <form id="jc-form" onsubmit="event.preventDefault(); registerJcExpense();" class="space-y-4">
                        <p class="text-sm font-semibold text-blue-600 mb-3">Este gasto siempre se registra como Pagado por **Tania** y adeudado por **Juan**.</p>
                       
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase">Monto ($)</label>
                                <input type="number" name="monto" step="0.01" class="mt-1 block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="0.00" required>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase">Concepto (Enter/Tab para completar)</label>
                                <div class="autocomplete-container mt-1">
                                    <span id="suggestion-jc" class="autocomplete-suggestion text-sm"></span>
                                    <input type="text" name="concepto" id="concepto-jc" class="autocomplete-input block w-full rounded border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Ej: Club AEBU" required>
                                </div>
                            </div>
                        </div>
                       
                        <button type="submit" class="w-full py-2.5 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-lg mt-4">
                            Registrar Gasto JC
                        </button>
                    </form>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-1">Balance JC</h3>
                    <div id="jc-balance-display"></div>
                </div>

                <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-1">Últimos Gastos JC</h3>
                <ul id="jc-expense-list" class="divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    </ul>
            </div>

            <div id="balance-final-mensual" class="tab-content">
                <div class="space-y-6">
                   
                    <div class="p-6 bg-blue-50 border-2 border-blue-600 rounded-xl shadow-md">
                        <h3 class="text-xl font-extrabold text-blue-800 mb-4 border-b pb-2">BALANCE TOTAL DEL MES</h3>
                        <div id="combined-balance-display" class="mb-4"></div>
                       
                        <button onclick="resetMonthlyExpenses()" class="w-full py-2.5 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition shadow-lg mt-4">
                            CERRAR MES Y BORRAR TODO
                        </button>
                    </div>

                    <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-1">Resumen por Categoría</h3>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm font-semibold text-gray-700">
                        <div class="p-4 bg-white rounded-lg shadow border-l-4 border-blue-500">
                            <p>DIARIOS:</p>
                            <div id="daily-balance-summary" class="text-blue-600 text-base"></div>
                            <p id="daily-paid-summary" class="text-xs text-gray-500 mt-1"></p>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow border-l-4 border-blue-500">
                            <p>MENSUALES/ANUALES:</p>
                            <div id="monthly-balance-summary" class="text-blue-600 text-base"></div>
                            <p id="monthly-paid-summary" class="text-xs text-gray-500 mt-1"></p>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow border-l-4 border-blue-500">
                            <p>SOLO JC:</p>
                            <div id="jc-balance-summary" class="text-blue-600 text-base"></div>
                            <p id="jc-paid-summary" class="text-xs text-gray-500 mt-1"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center text-gray-500 text-sm mt-6">
            Desarrollado por JC & T
        </footer>
    </div>
   
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col items-end pointer-events-none">
        </div>

</body>
</html>
